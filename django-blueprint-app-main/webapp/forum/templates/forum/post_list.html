{% extends 'main/layout/layout.html' %}
{% block content %}

<h2>{{ thread.title }}</h2>

<div class="d-flex align-items-center mb-3">
  {% if thread.author.profile and thread.author.profile.avatar %}
    <img src="{{ thread.author.profile.avatar.url }}" 
         alt="avatar" class="rounded-circle me-3" 
         style="width:60px; height:60px; object-fit:cover;">
  {% else %}
    <img src="/media/avatars/default.png" 
         alt="avatar" class="rounded-circle me-3" 
         style="width:60px; height:60px; object-fit:cover;">
  {% endif %}
  <div>
    <p class="mb-0"><strong>Autor:</strong> {{ thread.author.username }}</p>
    <p class="mb-0 text-muted"><small>Utworzono: {{ thread.created_at|date:"d.m.Y H:i" }}</small></p>
  </div>
</div>

{% if thread.description %}
  <div class="mb-4">
    <p>{{ thread.description|linebreaks }}</p>
  </div>
{% endif %}

<a href="{% url 'forum:create_post' thread.id %}" class="btn btn-primary mb-3">Odpowiedz</a>

<div class="list-group">
  {% for post in posts %}
    <div class="list-group-item d-flex">
      
      {% if post.author.profile and post.author.profile.avatar %}
        <img src="{{ post.author.profile.avatar.url }}" 
             alt="avatar" class="rounded-circle me-3" 
             style="width:50px; height:50px; object-fit:cover;">
      {% endif %}

      <div class="flex-grow-1">
        <p>{{ post.content|linebreaks }}</p>
        <small class="text-muted">
          {{ post.author.username }} • {{ post.created_at|date:"d.m.Y H:i" }}
        </small>
      </div>

      {% if request.user.is_authenticated %}
        {% if request.user == post.author or request.user.is_staff %}
          <form method="post" action="{% url 'forum:delete_post' post.id %}" class="ms-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Na pewno usunąć ten post?');">Usuń</button>
          </form>
        {% endif %}
      {% endif %}
    </div>
  {% endfor %}
</div>

{% if request.user.is_authenticated %}
  {% if request.user == thread.author or request.user.is_staff %}
    <form method="post" action="{% url 'forum:delete_thread' thread.id %}" class="mt-3">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger" onclick="return confirm('Na pewno usunąć ten wątek i wszystkie odpowiedzi?');">Usuń wątek</button>
    </form>
  {% endif %}
{% endif %}

{% endblock %}
